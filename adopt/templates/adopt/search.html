 <!DOCTYPE html>
<html lang="en">

<head>
	<title>Pet Adoption Home</title>

	{% load static %}
	<link rel="icon" type="image/x-icon" href="{% static 'images/favicon.ico' %}">
	<link rel="stylesheet" href="{% static 'adopt/style.css' %}">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>

<body>
	{% include "adopt/navbar.html" %}

	<form>
		<span class="form_label">Age:</span>
		<span class="checkbox_container">
			{% for age in age_choices %}
				<input type="checkbox" id="{{ age }}" name="age" value="{{ age }}" onchange="fetch_results()">
				<label for="{{ age }}">{{ age }}</label>
			{% endfor %}
		</span><br>

		<span class="form_label">Sex:</span>
		<span class="checkbox_container">
			{% for sex in sex_choices %}
				<input type="checkbox" id="{{ sex }}" name="sex" value="{{ sex }}" onchange="fetch_results()">
				<label for="{{ sex }}">{{ sex }}</label>
			{% endfor %}
		</span><br>

		<label class="form_label" for="color">Color:</label>
	  	<select id="color" name="color" onchange="fetch_results()">
	  		{% for color in color_choices %}
		    	<option value="{{ color }}">{{ color }}</option>
		    {% endfor %}
	  	</select><br>

		<input type="checkbox" id="vaccinated" name="vaccinated" onchange="fetch_results()">
		<label class="form_label" for="vaccinated">Must be vaccinated</label><br>

		<input type="checkbox" id="house_trained" name="house_trained" onchange="fetch_results()">
		<label class="form_label" for="house_trained">Must be house-trained</label><br>

		<input type="checkbox" id="sterilized" name="sterilized" onchange="fetch_results()">
		<label class="form_label" for="sterilized">Must be sterilized</label><br><br>
	</form>

	<!-- Empty section that will be filled by the Javascript -->
	<div id="results"></div>
	
	<footer>
		<a href="https://www.freepik.com/free-vector/blank-white-notepaper-design_16397306.htm
		#query=diary%20page&position=0&from_view=keyword&track=ais">Image by rawpixel.com</a> on Freepik
	</footer>

	<script>
		function get_checked(name, checkbox_group) {
			var checked_values = [];

			for (const choice of checkbox_group) {
				if (choice.checked)
					checked_values.push([name, choice.value]);
			}

			return checked_values;
		}

		function fetch_results() {
			var age_checked = get_checked("age", document.getElementsByName("age"));
			var sex_checked = get_checked("sex", document.getElementsByName("sex"));
			
			var color = ["color", document.getElementById("color").value];

			var vaccinated = ["vaccinated", document.getElementById("vaccinated").checked];
			var house_trained = ["house_trained", document.getElementById("house_trained").checked];
			var sterilized = ["sterilized", document.getElementById("sterilized").checked];

			var param_list = age_checked.concat(sex_checked);
			param_list.push(color);
            param_list.push(vaccinated);
            param_list.push(house_trained);
            param_list.push(sterilized);

			var searchParams = new URLSearchParams(param_list);

			console.log(searchParams);

			fetch(`{% url 'adopt:search_results' %}?${searchParams.toString()}`)
			.then(response => {
				console.log(response);
				return response.text();
			})
			.then(html => {
				document.getElementById("results").innerHTML = html;    
			})
			.catch(err => {
				console.error(err);
				document.getElementById("results").innerHTML = "Search failed...";
			});
		}
	</script>
</body>

</html> 